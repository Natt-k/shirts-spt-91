<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบสั่งจองเสื้อรุ่น 91</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- html2canvas for Image Export -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <!-- jsPDF for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Import Maps -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom": "https://esm.sh/react-dom@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "recharts": "https://esm.sh/recharts@2.12.0?external=react,react-dom",
            "lucide-react": "https://esm.sh/lucide-react@0.303.0",
            "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
        }
    }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Sarabun', sans-serif;
        }

        /* --- แก้ไขส่วน Print --- */
        @media print {
            body, html, #root, main {
                visibility: hidden;
                overflow: visible !important;
                height: auto !important;
                width: auto !important;
                background: white !important;
                position: static !important;
            }
            .print-container, .print-container * {
                visibility: visible;
            }
            .print-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 0;
                background: white !important;
                color: black !important;
                box-shadow: none !important;
                border-radius: 0 !important;
            }
            .no-print, #loading, #error-box, aside, header {
                display: none !important;
            }
            .page-break {
                page-break-after: always;
            }
            .break-inside-avoid {
                break-inside: avoid;
            }
            table {
                width: 100% !important;
                border-collapse: collapse !important;
            }
            th, td {
                border: 1px solid #000 !important;
                padding: 4px !important;
            }
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05); 
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2); 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3); 
        }
        
        @keyframes bounce-in {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-bounce-in {
            animation: bounce-in 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 h-screen overflow-hidden">
    
    <div id="loading" class="fixed inset-0 flex items-center justify-center bg-slate-900 z-50">
        <div class="text-center">
            <div class="w-16 h-16 border-4 border-pink-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-slate-400 animate-pulse">กำลังโหลดระบบ...</p>
        </div>
    </div>

    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            createUserWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged 
        } from 'firebase/auth';
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            query, 
            orderBy, 
            onSnapshot,
            doc, 
            deleteDoc,
            writeBatch
        } from 'firebase/firestore';
        import { 
            PieChart, Pie, Cell, ResponsiveContainer, Tooltip as RechartsTooltip, Legend 
        } from 'recharts';
        import { 
            LogOut, User, LayoutDashboard, 
            Printer, Plus, Trash2, Search, 
            AlertCircle, CheckCircle, Shirt, Users, Layers, Upload, FileUp,
            FileSpreadsheet, Image as ImageIcon, FileText
        } from 'lucide-react';

        const hideLoading = () => {
            const el = document.getElementById('loading');
            if(el) el.style.display = 'none';
        };

        const firebaseConfig = {
            apiKey: "AIzaSyBjRQMJB8ZpUOSTrZvNlRej3ue2CytGKFw",
            authDomain: "shirts-spt-604-91.firebaseapp.com",
            projectId: "shirts-spt-604-91",
            storageBucket: "shirts-spt-604-91.firebasestorage.app",
            messagingSenderId: "698582622271",
            appId: "1:698582622271:web:561490678b7cdbb2d4188a",
            measurementId: "G-3B0LL7LC3Z"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const SIZES = ['SS', 'S', 'M', 'L', 'XL', '2XL', '3XL', '4XL', '5XL'];
        const NUMBER_OPTIONS = Array.from({length: 60}, (_, i) => (i + 1).toString());
        const BACK_STYLES = [
            { id: 'none', label: 'ไม่ใส่เลข' },
            { id: 'number', label: 'ใส่เลขที่ (1, 2, 3, ...)' },
            { id: 'room', label: 'ใส่เลขห้อง (เช่น 4)' },
            { id: 'grade_room', label: 'ใส่เลขระดับชั้นและห้อง (เช่น 64)' },
            { id: 'batch', label: 'ใส่เลขรุ่น (91)' },
        ];
        const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8', '#82ca9d', '#ffc658', '#ff7300'];

        const normalizeNumber = (num) => {
            const parsed = parseInt(num, 10);
            return isNaN(parsed) ? num : parsed.toString();
        };

        const splitCSVLine = (line) => {
            const result = [];
            let current = '';
            let inQuotes = false;
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim().replace(/^"|"$/g, ''));
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim().replace(/^"|"$/g, ''));
            return result;
        };

        const Login = ({ onLoginSuccess }) => {
            const [isRegistering, setIsRegistering] = useState(false);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            const handleAuth = async (e) => {
                e.preventDefault();
                setError('');
                try {
                    if (isRegistering) {
                        await createUserWithEmailAndPassword(auth, email, password);
                    } else {
                        await signInWithEmailAndPassword(auth, email, password);
                    }
                    onLoginSuccess();
                } catch (err) {
                    setError(err.message);
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 font-sans text-white p-4">
                    <div className="w-full max-w-md p-8 rounded-3xl bg-white/10 backdrop-blur-xl border border-white/20 shadow-2xl">
                        <div className="text-center mb-8">
                            <div className="w-20 h-20 mx-auto bg-gradient-to-tr from-pink-500 to-violet-500 rounded-2xl flex items-center justify-center shadow-lg mb-4 transform rotate-3">
                                <Shirt size={40} className="text-white" />
                            </div>
                            <h1 className="text-3xl font-bold tracking-tight">Shirt Order System</h1>
                            <p className="text-white/60 mt-2">ระบบสั่งจองเสื้อรุ่น 91</p>
                        </div>

                        <form onSubmit={handleAuth} className="space-y-6">
                            <div>
                                <label className="block text-sm font-medium text-white/80 mb-2">อีเมล</label>
                                <input 
                                    type="email" required
                                    className="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-pink-500 focus:ring-2 focus:ring-pink-500/50 outline-none transition-all text-white placeholder-white/30"
                                    placeholder="admin@school.ac.th"
                                    value={email} onChange={(e) => setEmail(e.target.value)}
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-white/80 mb-2">รหัสผ่าน</label>
                                <input 
                                    type="password" required
                                    className="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-pink-500 focus:ring-2 focus:ring-pink-500/50 outline-none transition-all text-white placeholder-white/30"
                                    placeholder="••••••••"
                                    value={password} onChange={(e) => setPassword(e.target.value)}
                                />
                            </div>
                            {error && (
                                <div className="p-3 rounded-lg bg-red-500/20 border border-red-500/50 text-red-200 text-sm flex items-center gap-2">
                                    <AlertCircle size={16} /> {error}
                                </div>
                            )}
                            <button type="submit" className="w-full py-3.5 rounded-xl bg-gradient-to-r from-pink-500 to-violet-600 hover:from-pink-400 hover:to-violet-500 text-white font-semibold shadow-lg shadow-pink-500/30 transition-all active:scale-95">
                                {isRegistering ? 'ลงทะเบียนผู้ดูแล' : 'เข้าสู่ระบบ'}
                            </button>
                        </form>
                        <div className="mt-6 text-center">
                            <button onClick={() => setIsRegistering(!isRegistering)} className="text-sm text-white/50 hover:text-white transition-colors">
                                {isRegistering ? 'มีบัญชีอยู่แล้ว? เข้าสู่ระบบ' : 'ยังไม่มีบัญชี? ลงทะเบียนใหม่'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [printView, setPrintView] = useState('production');
            const [students, setStudents] = useState([]);
            const [orders, setOrders] = useState([]);
            const [formStudent, setFormStudent] = useState({
                studentId: '', title: 'ด.ช.', firstName: '', lastName: '', grade: '', room: '', number: '1'
            });
            const [formOrder, setFormOrder] = useState({
                studentId: '', title: 'Mr.', engName: '', engSurname: '', number: '1', size: 'M', backStyle: 'none'
            });
            const [submitStatus, setSubmitStatus] = useState({type: '', msg: ''});
            const studentFileRef = useRef(null);
            const orderFileRef = useRef(null);

            useEffect(() => {
                const unsubscribeAuth = onAuthStateChanged(auth, (currentUser) => {
                    setUser(currentUser);
                    setLoading(false);
                });
                return () => unsubscribeAuth();
            }, []);

            useEffect(() => {
                if (!user) return;
                const unsubStudents = onSnapshot(collection(db, 'students'), (snapshot) => {
                    setStudents(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                });
                const unsubOrders = onSnapshot(query(collection(db, 'orders'), orderBy('timestamp', 'desc')), (snapshot) => {
                    setOrders(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                });
                return () => { unsubStudents(); unsubOrders(); };
            }, [user]);

            const handleAddStudent = async (e) => {
                e.preventDefault();
                if (!formStudent.studentId || !formStudent.firstName) return;
                try {
                    if (students.some(s => s.studentId === formStudent.studentId)) {
                        setSubmitStatus({ type: 'error', msg: 'รหัสนักเรียนนี้มีในระบบแล้ว' });
                        return;
                    }
                    await addDoc(collection(db, 'students'), formStudent);
                    setFormStudent({ studentId: '', title: 'ด.ช.', firstName: '', lastName: '', grade: '', room: '', number: '1' });
                    setSubmitStatus({ type: 'success', msg: 'เพิ่มรายชื่อนักเรียนสำเร็จ' });
                } catch (error) {
                    setSubmitStatus({ type: 'error', msg: 'เกิดข้อผิดพลาด' });
                }
            };

            const handleAddOrder = async (e) => {
                e.preventDefault();
                try {
                    const duplicate = orders.find(o => o.studentId === formOrder.studentId && formOrder.studentId !== '');
                    if (duplicate) {
                        setSubmitStatus({ type: 'error', msg: `นักเรียนรหัส ${formOrder.studentId} สั่งซื้อไปแล้ว` });
                        return;
                    }
                    if (!formOrder.studentId) {
                        const dupName = orders.find(o => o.engName.toLowerCase() === formOrder.engName.toLowerCase() && o.engSurname.toLowerCase() === formOrder.engSurname.toLowerCase());
                        if (dupName) {
                            setSubmitStatus({ type: 'error', msg: `ชื่อ ${formOrder.engName} มีการสั่งซื้อแล้ว` });
                            return;
                        }
                    }
                    const studentInfo = students.find(s => s.studentId === formOrder.studentId);
                    const newOrder = {
                        ...formOrder,
                        thaiName: studentInfo ? studentInfo.firstName : '',
                        thaiSurname: studentInfo ? studentInfo.lastName : '',
                        timestamp: new Date()
                    };
                    await addDoc(collection(db, 'orders'), newOrder);
                    setFormOrder({ ...formOrder, studentId: '', engName: '', engSurname: '', number: '1' });
                    setSubmitStatus({ type: 'success', msg: 'บันทึกสำเร็จ' });
                } catch (error) {
                    setSubmitStatus({ type: 'error', msg: 'บันทึกไม่สำเร็จ' });
                }
            };

            const handleStudentImport = (e) => {
                const file = e.target.files?.[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = async (event) => {
                    try {
                        const text = event.target?.result;
                        const rows = text.split('\n');
                        let count = 0;
                        const batch = writeBatch(db);
                        for (let rowStr of rows) {
                            if(!rowStr.trim()) continue;
                            const cols = splitCSVLine(rowStr);
                            if(cols.length < 7) continue;
                            const [id, title, fname, lname, grade, room, num] = cols;
                            if (!id || id.includes('เลขประจำตัว')) continue;
                            const cleanNum = normalizeNumber(num);
                            if (!students.some(s => s.studentId === id)) {
                                const newRef = doc(collection(db, 'students'));
                                batch.set(newRef, { studentId: id, title: title||'', firstName: fname||'', lastName: lname||'', grade: grade||'', room: room||'', number: cleanNum||'' });
                                count++;
                            }
                        }
                        if (count > 0) { await batch.commit(); setSubmitStatus({ type: 'success', msg: `นำเข้า ${count} รายชื่อ` }); }
                        else { setSubmitStatus({ type: 'error', msg: 'ไม่พบข้อมูลใหม่' }); }
                    } catch (error) { setSubmitStatus({ type: 'error', msg: 'Error Reading File' }); }
                    if (studentFileRef.current) studentFileRef.current.value = '';
                };
                reader.readAsText(file);
            };

            const handleOrderImport = (e) => {
                const file = e.target.files?.[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = async (event) => {
                    try {
                        const text = event.target?.result;
                        const rows = text.split('\n');
                        let count = 0;
                        const batch = writeBatch(db);
                        for (let i = 0; i < rows.length; i++) {
                            if(!rows[i].trim()) continue;
                            const cols = splitCSVLine(rows[i]);
                            if (cols.length < 8) continue;
                            const title = cols[2];
                            const engName = cols[3];
                            const engSurname = cols[4];
                            let number = cols[5];
                            const size = cols[6];
                            const backStyleText = cols[7] || '';
                            if (!engName || engName === 'ชื่อ(ภาษาอังกฤษ)') continue;
                            number = normalizeNumber(number);
                            const exists = orders.some(o => o.engName.toLowerCase() === engName.toLowerCase() && o.engSurname.toLowerCase() === engSurname.toLowerCase());
                            if (!exists) {
                                let backStyle = 'none';
                                if (backStyleText.includes('ไม่ใส่')) backStyle = 'none';
                                else if (backStyleText.includes('เลขที่')) backStyle = 'number';
                                else if (backStyleText.includes('เลขห้อง')) backStyle = 'room';
                                else if (backStyleText.includes('ชั้น') || backStyleText.includes('64')) backStyle = 'grade_room';
                                else if (backStyleText.includes('รุ่น') || backStyleText.includes('91')) backStyle = 'batch';
                                const linkedStudent = students.find(s => String(s.number).trim() === String(number).trim());
                                const newRef = doc(collection(db, 'orders'));
                                batch.set(newRef, {
                                    studentId: linkedStudent ? linkedStudent.studentId : '',
                                    title: title, engName: engName, engSurname: engSurname, number: number, size: size, backStyle: backStyle,
                                    thaiName: linkedStudent ? linkedStudent.firstName : '', thaiSurname: linkedStudent ? linkedStudent.lastName : '',
                                    timestamp: new Date(Date.now() + i * 100)
                                });
                                count++;
                            }
                        }
                        if (count > 0) { await batch.commit(); setSubmitStatus({ type: 'success', msg: `นำเข้า ${count} รายการ` }); }
                        else { setSubmitStatus({ type: 'error', msg: 'ไม่พบรายการใหม่' }); }
                    } catch (error) { setSubmitStatus({ type: 'error', msg: 'Error Reading File' }); }
                    if (orderFileRef.current) orderFileRef.current.value = '';
                };
                reader.readAsText(file);
            };

            const handleDeleteOrder = async (id) => {
                if(confirm('ยืนยันการลบ?')) await deleteDoc(doc(db, 'orders', id));
            };

            const findStudentForOrder = (order) => {
                if (!students || students.length === 0) return null;
                if (order.studentId) {
                    const byId = students.find(s => s.studentId === order.studentId);
                    if (byId) return byId;
                }
                return students.find(s => String(s.number).trim() === String(order.number).trim());
            };

            const getBackDetail = (o, st) => {
                if (o.backStyle === 'none') return '-';
                if (o.backStyle === 'number') return o.number;
                if (o.backStyle === 'room') return st?.room || '-';
                if (o.backStyle === 'grade_room') return st ? `${st.grade}${st.room}` : '-';
                if (o.backStyle === 'batch') return '91';
                return '-';
            };

            const handleExportCSV = () => {
                let csvContent = "data:text/csv;charset=utf-8,\uFEFF"; // BOM for Thai support
                if (printView === 'production') {
                    csvContent += "Size,No.,Screen Name,Back Number,Note\n";
                    SIZES.forEach(size => {
                        const sizeOrders = orders.filter(o => o.size === size);
                        if (sizeOrders.length > 0) {
                            sizeOrders.forEach((o, index) => {
                                const st = findStudentForOrder(o);
                                const back = getBackDetail(o, st);
                                csvContent += `"${size}","${index + 1}","${o.engName}","${back}",""\n`;
                            });
                        }
                    });
                } else {
                    csvContent += "Number,Thai Name,Size,Screen Name,Back Number,Signature\n";
                    const sorted = [...orders].sort((a,b) => parseInt(a.number) - parseInt(b.number));
                    sorted.forEach(o => {
                        const st = findStudentForOrder(o);
                        let thai = st ? `${st.title}${st.firstName} ${st.lastName}` : (o.thaiName ? `${o.thaiName} ${o.thaiSurname||''}` : '-');
                        const back = getBackDetail(o, st);
                        csvContent += `"${o.number}","${thai}","${o.size}","${o.engName}","${back}",""\n`;
                    });
                }
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `report_${printView}_${new Date().toISOString().slice(0,10)}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const handleExportImage = async () => {
                const element = document.querySelector('.print-container');
                if (!element) return;
                
                // --- FIX: Scroll to top before capture to avoid whitespace/cutoff ---
                const originalScrollY = window.scrollY;
                window.scrollTo(0, 0);

                try {
                    const canvas = await html2canvas(element, { 
                        scale: 2, 
                        backgroundColor: '#ffffff', 
                        useCORS: true,
                        // Force start at top-left
                        scrollY: 0,
                        scrollX: 0,
                        windowWidth: document.documentElement.offsetWidth,
                        windowHeight: document.documentElement.offsetHeight
                    });
                    const link = document.createElement('a');
                    link.download = `report_${printView}_${new Date().toISOString().slice(0,10)}.png`;
                    link.href = canvas.toDataURL();
                    link.click();
                } catch (err) {
                    alert("ไม่สามารถส่งออกรูปภาพได้: " + err.message);
                } finally {
                    // Restore scroll position
                    window.scrollTo(0, originalScrollY);
                }
            };

            const handleExportPDF = async () => {
                const element = document.querySelector('.print-container');
                if (!element) return;

                // --- FIX: Scroll to top before capture ---
                const originalScrollY = window.scrollY;
                window.scrollTo(0, 0);

                try {
                    const canvas = await html2canvas(element, { 
                        scale: 2, 
                        backgroundColor: '#ffffff',
                        useCORS: true,
                        logging: false,
                        // Force start at top-left
                        scrollY: 0,
                        scrollX: 0,
                        windowWidth: document.documentElement.offsetWidth,
                        windowHeight: document.documentElement.offsetHeight
                    });
                    
                    const imgData = canvas.toDataURL('image/png');
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const imgWidth = 210; // A4 width in mm
                    const pageHeight = 297; // A4 height in mm
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 0;

                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;

                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }
                    
                    pdf.save(`report_${printView}_${new Date().toISOString().slice(0,10)}.pdf`);
                } catch (err) {
                    console.error(err);
                    alert("เกิดข้อผิดพลาดในการสร้าง PDF");
                } finally {
                    // Restore scroll position
                    window.scrollTo(0, originalScrollY);
                }
            };

            const stats = useMemo(() => {
                const totalOrders = orders.length;
                const sizeDistribution = SIZES.map(size => ({ name: size, value: orders.filter(o => o.size === size).length })).filter(d => d.value > 0);
                const styleDistribution = BACK_STYLES.map(style => ({ name: style.label, value: orders.filter(o => o.backStyle === style.id).length })).filter(d => d.value > 0);
                return { totalOrders, sizeDistribution, styleDistribution };
            }, [orders]);

            useEffect(() => {
                hideLoading();
            }, []);

            if (loading) return <div className="h-screen w-full flex items-center justify-center bg-slate-900 text-white">Loading...</div>;
            if (!user) return <Login onLoginSuccess={() => {}} />;

            return (
                <div className="flex h-screen bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900 text-slate-100 font-sans overflow-hidden">
                    <aside className="w-20 lg:w-64 flex flex-col bg-white/5 backdrop-blur-xl border-r border-white/10 transition-all duration-300 no-print">
                        <div className="p-6 flex items-center justify-center lg:justify-start gap-4">
                            <div className="bg-gradient-to-tr from-pink-500 to-violet-500 p-2 rounded-xl shadow-lg"><Shirt className="text-white" size={24} /></div>
                            <span className="text-xl font-bold hidden lg:block tracking-wide">ShirtSys</span>
                        </div>
                        <nav className="flex-1 px-4 py-6 space-y-2">
                            {[
                                { id: 'dashboard', icon: LayoutDashboard, label: 'แดชบอร์ด' },
                                { id: 'students', icon: Users, label: 'รายชื่อนักเรียน' },
                                { id: 'orders', icon: CheckCircle, label: 'สั่งซื้อเสื้อ' },
                                { id: 'summary', icon: Layers, label: 'สรุปข้อมูล' },
                                { id: 'print', icon: Printer, label: 'พิมพ์รายงาน' },
                            ].map((item) => (
                                <button key={item.id} onClick={() => setActiveTab(item.id)} className={`w-full flex items-center gap-4 px-4 py-3 rounded-xl transition-all duration-200 group ${activeTab === item.id ? 'bg-gradient-to-r from-pink-500/20 to-violet-500/20 border border-pink-500/30 text-pink-300' : 'hover:bg-white/5 text-slate-400 hover:text-white'}`}>
                                    <item.icon size={20} className={activeTab === item.id ? 'text-pink-400' : 'group-hover:text-white'} />
                                    <span className="hidden lg:block font-medium">{item.label}</span>
                                </button>
                            ))}
                        </nav>
                        <div className="p-4 border-t border-white/10">
                            <button onClick={() => signOut(auth)} className="w-full flex items-center gap-4 px-4 py-3 rounded-xl text-slate-400 hover:bg-red-500/10 hover:text-red-400 transition-all">
                                <LogOut size={20} /><span className="hidden lg:block">ออกจากระบบ</span>
                            </button>
                        </div>
                    </aside>

                    <main className="flex-1 overflow-y-auto">
                        <header className="sticky top-0 z-10 bg-slate-900/80 backdrop-blur-md border-b border-white/10 px-8 py-4 flex justify-between items-center no-print">
                            <h2 className="text-2xl font-bold bg-gradient-to-r from-pink-400 to-violet-400 bg-clip-text text-transparent">
                                {activeTab === 'dashboard' && 'แดชบอร์ดภาพรวม'}
                                {activeTab === 'students' && 'จัดการรายชื่อนักเรียน'}
                                {activeTab === 'orders' && 'บันทึกการสั่งซื้อ'}
                                {activeTab === 'summary' && 'สรุปข้อมูลสั่งจอง'}
                                {activeTab === 'print' && 'พิมพ์รายงาน'}
                            </h2>
                            <div className="flex items-center gap-3 bg-white/5 px-4 py-2 rounded-full border border-white/10">
                                <User size={16} className="text-pink-400" /><span className="text-sm font-medium">{user.email}</span>
                            </div>
                        </header>

                        <div className="p-8">
                            {submitStatus.msg && (
                                <div className={`fixed top-20 right-8 z-50 px-6 py-4 rounded-xl shadow-2xl backdrop-blur-xl border flex items-center gap-3 animate-bounce-in ${submitStatus.type === 'success' ? 'bg-green-500/20 border-green-500/50 text-green-200' : 'bg-red-500/20 border-red-500/50 text-red-200'}`}>
                                    {submitStatus.type === 'success' ? <CheckCircle size={20} /> : <AlertCircle size={20} />}
                                    {submitStatus.msg}
                                    <button onClick={() => setSubmitStatus({type: '', msg: ''})} className="ml-4 hover:text-white">x</button>
                                </div>
                            )}

                            {activeTab === 'dashboard' && (
                                <div className="space-y-6">
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                        <div className="bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-2xl shadow-xl">
                                            <p className="text-slate-400 text-sm">ยอดสั่งจองทั้งหมด</p>
                                            <h3 className="text-4xl font-bold mt-2">{stats.totalOrders} <span className="text-lg text-slate-500 font-normal">ตัว</span></h3>
                                        </div>
                                        <div className="bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-2xl shadow-xl">
                                            <p className="text-slate-400 text-sm">ไซต์ยอดนิยม</p>
                                            <h3 className="text-4xl font-bold mt-2">{stats.sizeDistribution.sort((a,b) => b.value - a.value)[0]?.name || '-'}</h3>
                                        </div>
                                        <div className="bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-2xl shadow-xl">
                                            <p className="text-slate-400 text-sm">นักเรียนทั้งหมด</p>
                                            <h3 className="text-4xl font-bold mt-2">{students.length} <span className="text-lg text-slate-500 font-normal">คน</span></h3>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <div className="bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-2xl shadow-xl h-96">
                                            <h3 className="text-lg font-semibold mb-6">สัดส่วนขนาดเสื้อ</h3>
                                            <ResponsiveContainer width="100%" height="100%">
                                                <PieChart><Pie data={stats.sizeDistribution} cx="50%" cy="50%" innerRadius={60} outerRadius={100} paddingAngle={5} dataKey="value">{stats.sizeDistribution.map((e, i) => <Cell key={`cell-${i}`} fill={COLORS[i % COLORS.length]} />)}</Pie><RechartsTooltip contentStyle={{backgroundColor:'#1e293b', border:'none', borderRadius:'8px', color:'#fff'}} /><Legend /></PieChart>
                                            </ResponsiveContainer>
                                        </div>
                                        <div className="bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-2xl shadow-xl h-96">
                                            <h3 className="text-lg font-semibold mb-6">รูปแบบด้านหลัง</h3>
                                            <ResponsiveContainer width="100%" height="100%">
                                                <PieChart><Pie data={stats.styleDistribution} cx="50%" cy="50%" innerRadius={60} outerRadius={100} paddingAngle={5} dataKey="value">{stats.styleDistribution.map((e, i) => <Cell key={`cell-${i}`} fill={COLORS[(i+3) % COLORS.length]} />)}</Pie><RechartsTooltip contentStyle={{backgroundColor:'#1e293b', border:'none', borderRadius:'8px', color:'#fff'}} /><Legend /></PieChart>
                                            </ResponsiveContainer>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'students' && (
                                <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                    <div className="lg:col-span-1">
                                        <div className="bg-white/5 backdrop-blur-xl border border-white/10 p-6 rounded-2xl shadow-lg sticky top-24">
                                            <div className="mb-8 p-4 bg-white/5 rounded-xl border border-white/10 border-dashed text-center">
                                                <input type="file" accept=".csv" ref={studentFileRef} onChange={handleStudentImport} className="hidden" />
                                                <button onClick={() => studentFileRef.current?.click()} className="w-full py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm transition-colors flex items-center justify-center gap-2 mb-2"><Upload size={14} /> นำเข้า CSV</button>
                                                <p className="text-[10px] text-slate-500">Format: ID, คำนำ, ชื่อ, สกุล, ชั้น, ห้อง, เลขที่</p>
                                            </div>
                                            <h3 className="text-xl font-bold mb-6 flex items-center gap-2"><Plus className="text-pink-400" /> เพิ่มรายชื่อ</h3>
                                            <form onSubmit={handleAddStudent} className="space-y-4">
                                                <input type="text" required placeholder="เลขประจำตัว" className="w-full bg-slate-900/50 border border-white/10 rounded-lg px-4 py-2 focus:border-pink-500 outline-none" value={formStudent.studentId} onChange={e => setFormStudent({...formStudent, studentId: e.target.value})} />
                                                <div className="grid grid-cols-3 gap-2">
                                                    <select className="bg-slate-900/50 border border-white/10 rounded-lg px-2 py-2 outline-none" value={formStudent.title} onChange={e => setFormStudent({...formStudent, title: e.target.value})}>
                                                        <option>ด.ช.</option><option>ด.ญ.</option><option>นาย</option><option>น.ส.</option>
                                                    </select>
                                                    <input type="text" required placeholder="ชื่อ" className="col-span-2 bg-slate-900/50 border border-white/10 rounded-lg px-4 py-2 outline-none" value={formStudent.firstName} onChange={e => setFormStudent({...formStudent, firstName: e.target.value})} />
                                                </div>
                                                <input type="text" required placeholder="นามสกุล" className="w-full bg-slate-900/50 border border-white/10 rounded-lg px-4 py-2 outline-none" value={formStudent.lastName} onChange={e => setFormStudent({...formStudent, lastName: e.target.value})} />
                                                <div className="grid grid-cols-3 gap-2">
                                                    <input type="text" required placeholder="ชั้น" className="bg-slate-900/50 border border-white/10 rounded-lg px-2 py-2 outline-none text-center" value={formStudent.grade} onChange={e => setFormStudent({...formStudent, grade: e.target.value})} />
                                                    <input type="text" required placeholder="ห้อง" className="bg-slate-900/50 border border-white/10 rounded-lg px-2 py-2 outline-none text-center" value={formStudent.room} onChange={e => setFormStudent({...formStudent, room: e.target.value})} />
                                                    <select required className="bg-slate-900/50 border border-white/10 rounded-lg px-2 py-2 outline-none text-center" value={formStudent.number} onChange={e => setFormStudent({...formStudent, number: e.target.value})}>
                                                        {NUMBER_OPTIONS.map(num => <option key={num} value={num}>{num}</option>)}
                                                    </select>
                                                </div>
                                                <button type="submit" className="w-full bg-pink-500 hover:bg-pink-600 text-white font-semibold py-3 rounded-xl shadow-lg">บันทึก</button>
                                            </form>
                                        </div>
                                    </div>
                                    <div className="lg:col-span-2">
                                        <div className="bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl shadow-lg overflow-hidden">
                                            <div className="p-4 bg-white/5 border-b border-white/10 flex justify-between items-center">
                                                <h3 className="font-semibold">รายชื่อ ({students.length})</h3>
                                            </div>
                                            <div className="overflow-x-auto max-h-[600px]">
                                                <table className="w-full text-left text-sm text-slate-300">
                                                    <thead className="bg-white/5 text-slate-100 uppercase sticky top-0 z-10 backdrop-blur-md"><tr><th className="px-6 py-3">ID</th><th className="px-6 py-3">ชื่อ-สกุล</th><th className="px-6 py-3">ชั้น/ห้อง</th><th className="px-6 py-3">เลขที่</th><th className="px-6 py-3">Action</th></tr></thead>
                                                    <tbody className="divide-y divide-white/5">
                                                        {students.map(s => (
                                                            <tr key={s.id} className="hover:bg-white/5"><td className="px-6 py-3">{s.studentId}</td><td className="px-6 py-3">{s.title}{s.firstName} {s.lastName}</td><td className="px-6 py-3">ม.{s.grade}/{s.room}</td><td className="px-6 py-3">{s.number}</td><td className="px-6 py-3"><button className="text-red-400" onClick={() => deleteDoc(doc(db, 'students', s.id))}><Trash2 size={16}/></button></td></tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'orders' && (
                                <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                    <div className="lg:col-span-1">
                                        <div className="bg-white/5 backdrop-blur-xl border border-white/10 p-6 rounded-2xl shadow-lg sticky top-24">
                                            <div className="mb-8 p-4 bg-white/5 rounded-xl border border-white/10 border-dashed text-center">
                                                <input type="file" accept=".csv" ref={orderFileRef} onChange={handleOrderImport} className="hidden" />
                                                <button onClick={() => orderFileRef.current?.click()} className="w-full py-2 bg-violet-700 hover:bg-violet-600 rounded-lg text-sm transition-colors flex items-center justify-center gap-2 mb-2"><Upload size={14} /> นำเข้า Google Forms</button>
                                            </div>
                                            <h3 className="text-xl font-bold mb-6 flex items-center gap-2"><Shirt className="text-violet-400" /> สั่งจอง</h3>
                                            <form onSubmit={handleAddOrder} className="space-y-4">
                                                <div className="flex gap-2">
                                                    <input type="text" placeholder="ID ค้นหา" className="w-full bg-slate-900/50 border border-white/10 rounded-lg px-4 py-2 focus:border-violet-500 outline-none" value={formOrder.studentId} onChange={e => {
                                                        const val = e.target.value; setFormOrder({...formOrder, studentId: val});
                                                        const found = students.find(s => s.studentId === val);
                                                        if(found) setFormOrder(prev => ({...prev, studentId: val, number: found.number}));
                                                    }} />
                                                </div>
                                                {students.find(s => s.studentId === formOrder.studentId) && <p className="text-green-400 text-xs">พบ: {students.find(s => s.studentId === formOrder.studentId)?.firstName}</p>}
                                                <div className="grid grid-cols-3 gap-2">
                                                    <select className="bg-slate-900/50 border border-white/10 rounded-lg px-2 py-2 outline-none" value={formOrder.title} onChange={e => setFormOrder({...formOrder, title: e.target.value})}><option>Mr.</option><option>Miss</option><option>Mrs.</option></select>
                                                    <input type="text" required placeholder="Eng Name" className="col-span-2 bg-slate-900/50 border border-white/10 rounded-lg px-4 py-2 outline-none" value={formOrder.engName} onChange={e => setFormOrder({...formOrder, engName: e.target.value})} />
                                                </div>
                                                <input type="text" required placeholder="Eng Surname" className="w-full bg-slate-900/50 border border-white/10 rounded-lg px-4 py-2 outline-none" value={formOrder.engSurname} onChange={e => setFormOrder({...formOrder, engSurname: e.target.value})} />
                                                <div className="grid grid-cols-2 gap-4">
                                                    <select required className="bg-slate-900/50 border border-white/10 rounded-lg px-4 py-2 outline-none text-center" value={formOrder.number} onChange={e => setFormOrder({...formOrder, number: e.target.value})}>{NUMBER_OPTIONS.map(num => <option key={num} value={num}>{num}</option>)}</select>
                                                    <select className="bg-slate-900/50 border border-white/10 rounded-lg px-4 py-2 outline-none" value={formOrder.size} onChange={e => setFormOrder({...formOrder, size: e.target.value})}>{SIZES.map(s => <option key={s} value={s}>{s}</option>)}</select>
                                                </div>
                                                <select className="w-full bg-slate-900/50 border border-white/10 rounded-lg px-4 py-2 outline-none" value={formOrder.backStyle} onChange={e => setFormOrder({...formOrder, backStyle: e.target.value})}>{BACK_STYLES.map(style => <option key={style.id} value={style.id}>{style.label}</option>)}</select>
                                                <button type="submit" className="w-full bg-violet-600 hover:bg-violet-700 text-white font-semibold py-3 rounded-xl shadow-lg">ยืนยัน</button>
                                            </form>
                                        </div>
                                    </div>
                                    <div className="lg:col-span-2">
                                        <div className="bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl shadow-lg overflow-hidden">
                                            <div className="p-4 bg-white/5 border-b border-white/10"><h3 className="font-semibold">รายการล่าสุด ({orders.length})</h3></div>
                                            <div className="overflow-x-auto max-h-[700px]">
                                                <table className="w-full text-left text-sm text-slate-300">
                                                    <thead className="bg-white/5 text-slate-100 uppercase sticky top-0 z-10 backdrop-blur-md"><tr><th className="px-6 py-3">เลขที่</th><th className="px-6 py-3">ชื่อ (Eng)</th><th className="px-6 py-3 text-center">Size</th><th className="px-6 py-3 text-center">Back</th><th className="px-6 py-3 text-right">Action</th></tr></thead>
                                                    <tbody className="divide-y divide-white/5">
                                                        {orders.map(o => (
                                                            <tr key={o.id} className="hover:bg-white/5"><td className="px-6 py-3 font-mono">{o.number}</td><td className="px-6 py-3">{o.title} {o.engName} {o.engSurname}</td><td className="px-6 py-3 text-center">{o.size}</td><td className="px-6 py-3 text-center text-xs opacity-70">{BACK_STYLES.find(b => b.id === o.backStyle)?.label}</td><td className="px-6 py-3 text-right"><button onClick={() => handleDeleteOrder(o.id)} className="text-slate-500 hover:text-red-400"><Trash2 size={16}/></button></td></tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'summary' && (
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div className="bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl p-6 shadow-lg">
                                        <h3 className="text-xl font-bold mb-4 text-pink-300">สรุปยอดตามไซส์</h3>
                                        <div className="space-y-3">
                                            {SIZES.map(size => {
                                                const count = orders.filter(o => o.size === size).length;
                                                const percentage = orders.length > 0 ? (count / orders.length) * 100 : 0;
                                                return <div key={size} className="flex items-center gap-4"><div className="w-12 font-bold text-center bg-white/10 rounded py-1">{size}</div><div className="flex-1 h-3 bg-white/5 rounded-full overflow-hidden"><div className="h-full bg-gradient-to-r from-pink-500 to-violet-500" style={{width: `${percentage}%`}}></div></div><div className="w-16 text-right font-mono">{count} ตัว</div></div>
                                            })}
                                            <div className="pt-4 mt-4 border-t border-white/10 flex justify-between font-bold text-lg"><span>รวม</span><span>{orders.length} ตัว</span></div>
                                        </div>
                                    </div>
                                    <div className="bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl p-6 shadow-lg">
                                        <h3 className="text-xl font-bold mb-4 text-violet-300">สรุปรูปแบบหลังเสื้อ</h3>
                                        <div className="space-y-3">
                                            {BACK_STYLES.map(style => <div key={style.id} className="flex justify-between items-center p-3 bg-white/5 rounded-lg border border-white/5"><span className="text-sm">{style.label}</span><span className="font-bold font-mono bg-violet-500/20 text-violet-300 px-3 py-1 rounded-md">{orders.filter(o => o.backStyle === style.id).length}</span></div>)}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'print' && (
                                <div className="space-y-8">
                                    <div className="flex flex-col md:flex-row gap-6 justify-between items-start md:items-center no-print bg-white/5 p-6 rounded-2xl border border-white/10">
                                        <div className="flex gap-2 bg-slate-900/50 p-1 rounded-lg border border-white/10">
                                            <button onClick={() => setPrintView('production')} className={`px-4 py-2 rounded-md text-sm font-medium transition-all ${printView === 'production' ? 'bg-pink-500 text-white shadow-lg' : 'text-slate-400 hover:text-white'}`}>1. ใบสั่งผลิต</button>
                                            <button onClick={() => setPrintView('namelist')} className={`px-4 py-2 rounded-md text-sm font-medium transition-all ${printView === 'namelist' ? 'bg-violet-500 text-white shadow-lg' : 'text-slate-400 hover:text-white'}`}>2. ใบเช็คชื่อ</button>
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick={handleExportCSV} className="flex items-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg font-semibold shadow-lg transition-all"><FileSpreadsheet size={18} /> CSV</button>
                                            <button onClick={handleExportImage} className="flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-semibold shadow-lg transition-all"><ImageIcon size={18} /> PNG</button>
                                            <button onClick={handleExportPDF} className="flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold shadow-lg transition-all"><FileText size={18} /> PDF</button>
                                            <button onClick={() => window.print()} className="flex items-center gap-2 bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold shadow-lg transition-all"><Printer size={18} /> สั่งพิมพ์</button>
                                        </div>
                                    </div>
                                    
                                    <div className="print-container bg-white text-black p-8 rounded-xl shadow-2xl min-h-screen">
                                        <div className="text-center border-b-2 border-black pb-4 mb-6">
                                            <h1 className="text-2xl font-bold">รายงานสรุปการสั่งจองเสื้อรุ่น 91</h1>
                                            <p className="text-gray-600">วันที่พิมพ์: {new Date().toLocaleDateString('th-TH')}</p>
                                        </div>

                                        {printView === 'production' && (
                                            <div>
                                                <div className="bg-gray-100 p-2 border-l-4 border-black mb-4 flex justify-between items-center"><h2 className="text-xl font-bold">1. ใบสั่งผลิต (แยกตามไซต์)</h2><span className="text-sm font-semibold text-gray-500">รวม: {orders.length} ตัว</span></div>
                                                {SIZES.map(size => {
                                                    const sizeOrders = orders.filter(o => o.size === size);
                                                    if(sizeOrders.length === 0) return null;
                                                    return (
                                                        <div key={size} className="mb-8 break-inside-avoid">
                                                            <h3 className="font-bold text-lg border-b-2 border-gray-400 mb-2 flex justify-between bg-gray-50 px-2 py-1"><span>SIZE: {size}</span><span>{sizeOrders.length} ตัว</span></h3>
                                                            <table className="w-full text-sm border-collapse border border-gray-300">
                                                                <thead><tr className="bg-gray-200"><th className="border border-gray-300 px-2 py-1 w-12 text-center">ลำดับ</th><th className="border border-gray-300 px-2 py-1 text-left">ชื่อสกรีน (Eng Only)</th><th className="border border-gray-300 px-2 py-1 w-40 text-center">เลขหลังเสื้อ</th><th className="border border-gray-300 px-2 py-1 w-24 text-center">หมายเหตุ</th></tr></thead>
                                                                <tbody>
                                                                    {sizeOrders.map((o, idx) => (
                                                                        <tr key={o.id}>
                                                                            <td className="border border-gray-300 px-2 py-1 text-center">{idx + 1}</td>
                                                                            <td className="border border-gray-300 px-2 py-1 font-mono uppercase font-medium">{o.engName}</td>
                                                                            <td className="border border-gray-300 px-2 py-1 text-center text-xs">
                                                                                {getBackDetail(o, findStudentForOrder(o))}
                                                                            </td>
                                                                            <td className="border border-gray-300 px-2 py-1"></td>
                                                                        </tr>
                                                                    ))}
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    )
                                                })}
                                            </div>
                                        )}

                                        {printView === 'namelist' && (
                                            <div className="break-before-page">
                                                <div className="bg-gray-100 p-2 border-l-4 border-black mb-4"><h2 className="text-xl font-bold">2. ใบเช็คชื่อผู้สั่งจอง</h2></div>
                                                <table className="w-full text-sm border-collapse border border-black">
                                                    <thead><tr className="bg-gray-800 text-white"><th className="border border-black px-2 py-2 w-16">เลขที่</th><th className="border border-black px-2 py-2">ชื่อ-สกุล (ไทย)</th><th className="border border-black px-2 py-2 w-16 text-center">Size</th><th className="border border-black px-2 py-2">ชื่อสกรีน</th><th className="border border-black px-2 py-2 w-32">หลังเสื้อ</th><th className="border border-black px-2 py-2 w-24">ลายเซ็น</th></tr></thead>
                                                    <tbody>
                                                        {orders.sort((a,b) => parseInt(a.number) - parseInt(b.number)).map(o => (
                                                            <tr key={o.id}>
                                                                <td className="border border-black px-2 py-2 text-center font-bold">{o.number}</td>
                                                                <td className="border border-black px-2 py-2">
                                                                    {(() => {
                                                                        const st = findStudentForOrder(o);
                                                                        if (st) return `${st.title}${st.firstName} ${st.lastName}`;
                                                                        if (o.thaiName) return `${o.thaiName} ${o.thaiSurname || ''}`;
                                                                        return '-';
                                                                    })()}
                                                                </td>
                                                                <td className="border border-black px-2 py-2 text-center font-bold bg-gray-50">{o.size}</td>
                                                                <td className="border border-black px-2 py-2 uppercase font-mono">{o.engName}</td>
                                                                <td className="border border-black px-2 py-2 text-center text-xs">
                                                                    {getBackDetail(o, findStudentForOrder(o))}
                                                                </td>
                                                                <td className="border border-black px-2 py-2"></td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                                <div className="mt-8 flex justify-end">
                                                    <div className="text-center pr-12"><p>ลงชื่อ ....................................................... ผู้ตรวจสอบ</p><p className="mt-2">(.......................................................)</p></div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}
                        </div>
                    </main>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


